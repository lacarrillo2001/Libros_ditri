# Docker Compose para oauth-server
# Construye la imagen usando el Dockerfile en ./oauth-server
# Expone el puerto 9000 (configurado en src/main/resources/application.properties)

version: "3.8"

services:
  oauth-server:
    build:
      context: ./oauth-server
      dockerfile: Dockerfile
    image: oauth-server:latest
    ports:
      - "9000:9000"
    environment:
      # Spring Boot usa binding relajado, estas variables sobreescriben properties como app.security.user.username
      APP_SECURITY_USER_USERNAME: "juan"
      APP_SECURITY_USER_PASSWORD: "{noop}12345"
      APP_SECURITY_CLIENT_ID: "app-libro"
      APP_SECURITY_CLIENT_SECRET: "{noop}123456"
      APP_SECURITY_CLIENT_REDIRECT_URI_1: "http://libros:8001/login/oauth2/code/app-libro}"
      APP_SECURITY_CLIENT_REDIRECT_URI_2: "http://libros:8001/authorized"
      APP_SECURITY_CLIENT_POST_LOGOUT_REDIRECT_URI: "http://libros:8001/logout}"
    restart: unless-stopped
    networks:
      - libros-net

# Puedes crear un archivo .env en la misma carpeta para proveer valores locales.
# Ejemplo .env:
# APP_SECURITY_USER_USERNAME=juan
# APP_SECURITY_USER_PASSWORD={noop}12345
# APP_SECURITY_CLIENT_ID=app-libro
# APP_SECURITY_CLIENT_SECRET={noop}123456

